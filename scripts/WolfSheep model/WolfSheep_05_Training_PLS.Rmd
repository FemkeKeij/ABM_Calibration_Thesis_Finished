---
title: "WolfSheep_06_Training_PLS"
author: "Femke Keij S2647168"
date: "2023-07-12"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Clear working directory & set random seed:
```{r}
rm(list = ls(all = TRUE))

set.seed(42)
```

Packages used:
```{r}
# for importing / working with tidy data
library(tidyverse)

# for ggplot
library(directlabels)
library(patchwork)
library(ggbeeswarm)

# for creating the cross-validation folds
library(caret)

# for partial least squares
library(pls)

# for error computation
library(mltools)
```

Functions used:
```{r}
source('scripts/WolfSheep model/WolfSheep_Functions.R')
```

# Fitting with cross-validation
Function to cross-validate partial least squares:
```{r}
WolfSheepPLSFitting <- function(data_clean,
                                data_outputnoise,
                                data_doublenoise){
  # data_clean: the data frame containing the input parameters as well as the relevant outputs
  # data_outputnoise: the data frame containing the input parameters as well as the relevant outputs, with output noise
  # data_doublenoise: the data frame containing the input parameters as well as the relevant outputs, with output and temporal noise
  
  # check if there is data with output and temporal (double) noise
  double_noise <- !any(is.na(data_doublenoise))
  
  # create the folds
  flds <- createFolds(1:nrow(data_clean),
                      k = 5, list = TRUE, returnTrain = FALSE)

  # to store the results
  results_df <- tibble(fold = numeric(),
                       noise = character(),
                       initial_number_sheep = numeric(),
                       initial_number_sheep_pred = numeric(),
                       initial_number_wolves = numeric(),
                       initial_number_wolves_pred = numeric(),
                       sheep_gain_from_food = numeric(),
                       sheep_gain_from_food_pred = numeric(),
                       wolves_gain_from_food = numeric(),
                       wolves_gain_from_food_pred = numeric(),
                       sheep_reproduce = numeric(),
                       sheep_reproduce_pred = numeric(),
                       wolves_reproduce = numeric(),
                       wolves_reproduce_pred = numeric(),
                       grass_regrowth = numeric(),
                       grass_regrowth_pred = numeric())
  
  # for each cross-validation fold
  for(i in 1:5){
    print(c('started fold number ', as.character(i)))
    # remove the test fold to create the training data
    dat_train <- data_clean %>%
      filter(!row_number() %in% unlist(flds[i]))
  
    # obtain the test fold without noise
    dat_test <- data_clean %>%
      filter(row_number() %in% unlist(flds[i]))
    # obtain the test fold with output noise
    dat_test_outputnoise <- data_outputnoise %>%
      filter(row_number() %in% unlist(flds[i]))
    # obtain the test fold with output and temporal noise
    if(double_noise){
    dat_test_doublenoise <- data_doublenoise %>%
      filter(row_number() %in% unlist(flds[i]))
    }
    
    # train the partial least squares
    fit_pls <- plsr(cbind(initial_number_sheep,
                          initial_number_wolves,
                          sheep_gain_from_food,
                          wolves_gain_from_food,
                          sheep_reproduce,
                          wolves_reproduce,
                          grass_regrowth) ~ .,
                    data = dat_train, validation = 'LOO',
                    scale = TRUE)
    
    # cross-validation to determine number of components
    ncomp.cv <- crossval(fit_pls)$ncomp
    #ncomp.cv <- 100
   
    # predictions without noise
    predict_pls_clean <- predict(fit_pls,
                                 newdata = dat_test,
                                 ncomp = ncomp.cv)
    # predictions with output noise
    predict_pls_outputnoise <- predict(fit_pls,
                                       newdata = dat_test_outputnoise,
                                       ncomp = ncomp.cv)
    # predictions with double noise (if applicable)
    if(double_noise){
    predict_pls_doublenoise <- predict(fit_pls,
                                       newdata = dat_test_doublenoise,
                                       ncomp = ncomp.cv)
    }
    
    # add to dataframe, without noise
    results_df <- results_df %>%
      add_row(fold = i,
              noise = 'clean',
              initial_number_sheep = dat_test$initial_number_sheep,
              initial_number_sheep_pred = predict_pls_clean[, 1, 1],
              initial_number_wolves = dat_test$initial_number_wolves,
              initial_number_wolves_pred = predict_pls_clean[, 2, 1],
              sheep_gain_from_food = dat_test$sheep_gain_from_food,
              sheep_gain_from_food_pred = predict_pls_clean[, 3, 1],
              wolves_gain_from_food = dat_test$wolves_gain_from_food,
              wolves_gain_from_food_pred = predict_pls_clean[, 4, 1],
              sheep_reproduce = dat_test$sheep_reproduce,
              sheep_reproduce_pred = predict_pls_clean[, 5, 1],
              wolves_reproduce = dat_test$wolves_reproduce,
              wolves_reproduce_pred = predict_pls_clean[, 6, 1],
              grass_regrowth = dat_test$grass_regrowth,
              grass_regrowth_pred = predict_pls_clean[, 7, 1])
    # add to dataframe, output noise
    results_df <- results_df %>%
      add_row(fold = i,
              noise = 'output noise',
              initial_number_sheep = dat_test$initial_number_sheep,
              initial_number_sheep_pred = 
                predict_pls_outputnoise[, 1, 1],
              initial_number_wolves = dat_test$initial_number_wolves,
              initial_number_wolves_pred = 
                predict_pls_outputnoise[, 2, 1],
              sheep_gain_from_food = dat_test$sheep_gain_from_food,
              sheep_gain_from_food_pred = 
                predict_pls_outputnoise[, 3, 1],
              wolves_gain_from_food = dat_test$wolves_gain_from_food,
              wolves_gain_from_food_pred = 
                predict_pls_outputnoise[, 4, 1],
              sheep_reproduce = dat_test$sheep_reproduce,
              sheep_reproduce_pred = 
                predict_pls_outputnoise[, 5, 1],
              wolves_reproduce = dat_test$wolves_reproduce,
              wolves_reproduce_pred = 
                predict_pls_outputnoise[, 6, 1],
              grass_regrowth = dat_test$grass_regrowth,
              grass_regrowth_pred = 
                predict_pls_outputnoise[, 7, 1])
    # add to dataframe, with double noise (if applicable)
    if(double_noise){
      results_df <- results_df %>%
      add_row(fold = i,
              noise = 'double noise',
              initial_number_sheep = dat_test$initial_number_sheep,
              initial_number_sheep_pred = 
                predict_pls_doublenoise[, 1, 1],
              initial_number_wolves = dat_test$initial_number_wolves,
              initial_number_wolves_pred = 
                predict_pls_doublenoise[, 2, 1],
              sheep_gain_from_food = dat_test$sheep_gain_from_food,
              sheep_gain_from_food_pred = 
                predict_pls_doublenoise[, 3, 1],
              wolves_gain_from_food = dat_test$wolves_gain_from_food,
              wolves_gain_from_food_pred = 
                predict_pls_doublenoise[, 4, 1],
              sheep_reproduce = dat_test$sheep_reproduce,
              sheep_reproduce_pred = 
                predict_pls_doublenoise[, 5, 1],
              wolves_reproduce = dat_test$wolves_reproduce,
              wolves_reproduce_pred = 
                predict_pls_doublenoise[, 6, 1],
              grass_regrowth = dat_test$grass_regrowth,
              grass_regrowth_pred = 
                predict_pls_doublenoise[, 7, 1])
    }
  }
  return(results_df)
}
```

Now fit regressions for all data combinations:
- endpoints only, full time series, timesteps every 10, 20, or 50 ticks
- runs summarised or not
- data without noise, data with output noise, data with output and temporal noise
- random vs. LHS sampling
- 1250, 5000, vs. 10000 samples

Endpoints only:
```{r}
# not summarised
# read in relevant data, add id's
data_end_full_clean <- 
  read_csv('data/training/ws_end_full_clean.csv') %>%
  distinct() %>%
  mutate(id = row_number())
data_end_full_outputnoise <-
  read_csv('data/training/ws_end_full_outputnoise.csv') %>%
  distinct(min_sheep, min_wolves, min_grass,
           max_sheep, max_wolves, max_grass,
           sd_sheep, sd_wolves, sd_grass,
           trend_sheep, trend_wolves, trend_grass,
           mean_sheep, mean_wolves, mean_grass,
           initial_number_sheep,  initial_number_wolves,
           sheep_gain_from_food, wolves_gain_from_food,
           sheep_reproduce, wolves_reproduce,
           grass_regrowth,
           .keep_all = TRUE) %>%
  mutate(id = row_number() + nrow(data_end_full_clean))

# no temporal noise here because it's endpoints only

# fit regression
fit_end_full <- WolfSheepPLSFitting(
  data_clean = data_end_full_clean,
  data_outputnoise = data_end_full_outputnoise,
  data_doublenoise = NA)

# compute errors
errors_df <- WSComputeErrors(predictions = fit_end_full,
                             sample_size = 200,
                             sample_method = 'random',
                             summarise_runs = 'full',
                             datapoints = 'endpoints',
                             double_noise = FALSE)

# summarised
data_end_sum_clean <- 
  read_csv('data/training/ws_end_sum_clean.csv') %>%
  distinct() %>%
  mutate(id = row_number())
data_end_sum_outputnoise <-
  read_csv('data/training/ws_end_sum_outputnoise.csv') %>%
  distinct(min_sheep, min_wolves, min_grass,
           max_sheep, max_wolves, max_grass,
           sd_sheep, sd_wolves, sd_grass,
           trend_sheep, trend_wolves, trend_grass,
           mean_sheep, mean_wolves, mean_grass,
           initial_number_sheep,  initial_number_wolves,
           sheep_gain_from_food, wolves_gain_from_food,
           sheep_reproduce, wolves_reproduce,
           grass_regrowth,
           .keep_all = TRUE) %>%
  mutate(id = row_number() + nrow(data_end_sum_clean))

fit_end_sum <- WolfSheepPLSFitting(
  data_clean = data_end_sum_clean,
  data_outputnoise = data_end_sum_outputnoise,
  data_doublenoise = NA)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_end_sum,
                          sample_size = 200,
                          sample_method = 'random',
                          summarise_runs = 'summarised',
                          datapoints = 'endpoints',
                          double_noise = FALSE))
```

Timesteps every 10 ticks
```{r}
# not summarised

# shorten dataframe to shorten run time?
data_10_full_clean <- 
  read_csv('data/training/ws_10_full_clean.csv') %>%
  distinct() %>%
  mutate(id = row_number()) %>%
  # remove last 300 ticks to shorten runtime
  select(- c(wolves_200:wolves_500),
         - c(sheep_200:sheep_500),
         - c(grass_200:grass_500))
data_10_full_outputnoise <- 
  read_csv('data/training/ws_10_full_outputnoise.csv') %>%
  distinct(min_sheep, min_wolves, min_grass,
           max_sheep, max_wolves, max_grass,
           sd_sheep, sd_wolves, sd_grass,
           trend_sheep, trend_wolves, trend_grass,
           mean_sheep, mean_wolves, mean_grass,
           initial_number_sheep,  initial_number_wolves,
           sheep_gain_from_food, wolves_gain_from_food,
           sheep_reproduce, wolves_reproduce,
           grass_regrowth,
           .keep_all = TRUE) %>%
  mutate(id = row_number() + nrow(data_10_full_clean)) %>%
  # remove last 300 ticks to avoid shorten runtime
  select(- c(wolves_200:wolves_500),
         - c(sheep_200:sheep_500),
         - c(grass_200:grass_500))
data_10_full_doublenoise <- 
  read_csv('data/training/ws_10_full_doublenoise.csv') %>%
  distinct(min_sheep, min_wolves, min_grass,
           max_sheep, max_wolves, max_grass,
           sd_sheep, sd_wolves, sd_grass,
           trend_sheep, trend_wolves, trend_grass,
           mean_sheep, mean_wolves, mean_grass,
           initial_number_sheep,  initial_number_wolves,
           sheep_gain_from_food, wolves_gain_from_food,
           sheep_reproduce, wolves_reproduce,
           grass_regrowth,
           .keep_all = TRUE) %>%
  mutate(id = row_number() + 2 * nrow(data_10_full_clean)) %>%
  # remove last 300 ticks to avoid shorten runtime
  select(- c(wolves_200:wolves_500),
         - c(sheep_200:sheep_500),
         - c(grass_200:grass_500))

fit_10_full <- WolfSheepPLSFitting(
  data_clean = data_10_full_clean,
  data_outputnoise = data_10_full_outputnoise,
  data_doublenoise = data_10_full_doublenoise)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_10_full,
                             sample_size = 200,
                             sample_method = 'random',
                             summarise_runs = 'full',
                             datapoints = 'timesteps 10'))

# summarised
data_10_sum_clean <- 
  read_csv('data/training/ws_10_sum_clean.csv') %>%
  distinct() %>%
  mutate(id = row_number()) %>%
  # remove last 100 ticks to avoid rank deficient fits
  select(- c(wolves_410:wolves_500),
         - c(sheep_410:sheep_500),
         - c(grass_410:grass_500))
data_10_sum_outputnoise <- 
  read_csv('data/training/ws_10_sum_outputnoise.csv') %>%
  distinct(min_sheep, min_wolves, min_grass,
           max_sheep, max_wolves, max_grass,
           sd_sheep, sd_wolves, sd_grass,
           trend_sheep, trend_wolves, trend_grass,
           mean_sheep, mean_wolves, mean_grass,
           initial_number_sheep,  initial_number_wolves,
           sheep_gain_from_food, wolves_gain_from_food,
           sheep_reproduce, wolves_reproduce,
           grass_regrowth,
           .keep_all = TRUE) %>%
  mutate(id = row_number() + nrow(data_10_sum_clean)) %>%
  select(- c(wolves_410:wolves_500),
         - c(sheep_410:sheep_500),
         - c(grass_410:grass_500))
data_10_sum_doublenoise <- 
  read_csv('data/training/ws_10_sum_doublenoise.csv') %>%
  distinct(min_sheep, min_wolves, min_grass,
           max_sheep, max_wolves, max_grass,
           sd_sheep, sd_wolves, sd_grass,
           trend_sheep, trend_wolves, trend_grass,
           mean_sheep, mean_wolves, mean_grass,
           initial_number_sheep,  initial_number_wolves,
           sheep_gain_from_food, wolves_gain_from_food,
           sheep_reproduce, wolves_reproduce,
           grass_regrowth,
           .keep_all = TRUE) %>%
  mutate(id = row_number() + 2 * nrow(data_10_sum_clean)) %>%
  select(- c(wolves_410:wolves_500),
         - c(sheep_410:sheep_500),
         - c(grass_410:grass_500))

fit_10_sum <- WolfSheepPLSFitting(
  data_clean = data_10_sum_clean,
  data_outputnoise = data_10_sum_outputnoise,
  data_doublenoise = data_10_sum_doublenoise)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_10_sum,
                             sample_size = 200,
                             sample_method = 'random',
                             summarise_runs = 'summarised',
                             datapoints = 'timesteps 10'))
```

Timesteps every 20 ticks
```{r}
# not summarised
data_20_full_clean <-
  read_csv('data/training/ws_20_full_clean.csv') %>%
  distinct() %>%
  mutate(id = row_number()) %>%
  # remove last 250 ticks to avoid shorten runtime
  select(- c(wolves_260:wolves_500),
         - c(sheep_260:sheep_500),
         - c(grass_260:grass_500))
data_20_full_outputnoise <- 
  read_csv('data/training/ws_20_full_outputnoise.csv') %>%
  distinct(min_sheep, min_wolves, min_grass,
           max_sheep, max_wolves, max_grass,
           sd_sheep, sd_wolves, sd_grass,
           trend_sheep, trend_wolves, trend_grass,
           mean_sheep, mean_wolves, mean_grass,
           initial_number_sheep,  initial_number_wolves,
           sheep_gain_from_food, wolves_gain_from_food,
           sheep_reproduce, wolves_reproduce,
           grass_regrowth,
           .keep_all = TRUE) %>%
  mutate(id = row_number() + nrow(data_20_full_clean)) %>%
  # remove last 250 ticks to avoid shorten runtime
  select(- c(wolves_260:wolves_500),
         - c(sheep_260:sheep_500),
         - c(grass_260:grass_500))
data_20_full_doublenoise <- 
  read_csv('data/training/ws_20_full_doublenoise.csv') %>%
  distinct(min_sheep, min_wolves, min_grass,
           max_sheep, max_wolves, max_grass,
           sd_sheep, sd_wolves, sd_grass,
           trend_sheep, trend_wolves, trend_grass,
           mean_sheep, mean_wolves, mean_grass,
           initial_number_sheep,  initial_number_wolves,
           sheep_gain_from_food, wolves_gain_from_food,
           sheep_reproduce, wolves_reproduce,
           grass_regrowth,
           .keep_all = TRUE) %>%
  mutate(id = row_number() + 2 * nrow(data_20_full_clean)) %>%
  # remove last 250 ticks to avoid shorten runtime
  select(- c(wolves_260:wolves_500),
         - c(sheep_260:sheep_500),
         - c(grass_260:grass_500))
  
fit_20_full <- WolfSheepPLSFitting(
  data_clean = data_20_full_clean,
  data_outputnoise = data_20_full_outputnoise,
  data_doublenoise = data_20_full_doublenoise)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_20_full,
                             sample_size = 200,
                             sample_method = 'random',
                             summarise_runs = 'full',
                             datapoints = 'timesteps 20'))

# summarised
data_20_sum_clean <- 
  read_csv('data/training/ws_20_sum_clean.csv') %>%
  distinct() %>%
  mutate(id = row_number())
data_20_sum_outputnoise <- 
  read_csv('data/training/ws_20_sum_outputnoise.csv') %>%
  distinct(min_sheep, min_wolves, min_grass,
           max_sheep, max_wolves, max_grass,
           sd_sheep, sd_wolves, sd_grass,
           trend_sheep, trend_wolves, trend_grass,
           mean_sheep, mean_wolves, mean_grass,
           initial_number_sheep,  initial_number_wolves,
           sheep_gain_from_food, wolves_gain_from_food,
           sheep_reproduce, wolves_reproduce,
           grass_regrowth,
           .keep_all = TRUE) %>%
  mutate(id = row_number() + nrow(data_20_sum_clean))
data_20_sum_doublenoise <- 
  read_csv('data/training/ws_20_sum_doublenoise.csv') %>%
  distinct(min_sheep, min_wolves, min_grass,
           max_sheep, max_wolves, max_grass,
           sd_sheep, sd_wolves, sd_grass,
           trend_sheep, trend_wolves, trend_grass,
           mean_sheep, mean_wolves, mean_grass,
           initial_number_sheep,  initial_number_wolves,
           sheep_gain_from_food, wolves_gain_from_food,
           sheep_reproduce, wolves_reproduce,
           grass_regrowth,
           .keep_all = TRUE) %>%
  mutate(id = row_number() + 2 * nrow(data_20_sum_clean))

fit_20_sum <- WolfSheepPLSFitting(
  data_clean = data_20_sum_clean,
  data_outputnoise = data_20_sum_outputnoise,
  data_doublenoise = data_20_sum_doublenoise)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_20_sum,
                             sample_size = 200,
                             sample_method = 'random',
                             summarise_runs = 'summarised',
                             datapoints = 'timesteps 20'))
```

Timesteps every 50 ticks
```{r}
# not summarised
data_50_full_clean <- 
  read_csv('data/training/ws_50_full_clean.csv') %>%
  distinct() %>%
  mutate(id = row_number())
data_50_full_outputnoise <- 
  read_csv('data/training/ws_50_full_outputnoise.csv') %>%
  distinct(min_sheep, min_wolves, min_grass,
           max_sheep, max_wolves, max_grass,
           sd_sheep, sd_wolves, sd_grass,
           trend_sheep, trend_wolves, trend_grass,
           mean_sheep, mean_wolves, mean_grass,
           initial_number_sheep,  initial_number_wolves,
           sheep_gain_from_food, wolves_gain_from_food,
           sheep_reproduce, wolves_reproduce,
           grass_regrowth,
           .keep_all = TRUE) %>%
  mutate(id = row_number() + nrow(data_50_full_clean))
data_50_full_doublenoise <- 
  read_csv('data/training/ws_50_full_doublenoise.csv') %>%
  distinct(min_sheep, min_wolves, min_grass,
           max_sheep, max_wolves, max_grass,
           sd_sheep, sd_wolves, sd_grass,
           trend_sheep, trend_wolves, trend_grass,
           mean_sheep, mean_wolves, mean_grass,
           initial_number_sheep,  initial_number_wolves,
           sheep_gain_from_food, wolves_gain_from_food,
           sheep_reproduce, wolves_reproduce,
           grass_regrowth,
           .keep_all = TRUE) %>%
  mutate(id = row_number() + 2 * nrow(data_50_full_clean))

fit_50_full <- WolfSheepPLSFitting(
  data_clean = data_50_full_clean,
  data_outputnoise = data_50_full_outputnoise,
  data_doublenoise = data_50_full_doublenoise)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_50_full,
                             sample_size = 200,
                             sample_method = 'random',
                             summarise_runs = 'full',
                             datapoints = 'timesteps 50'))

# summarised
data_50_sum_clean <- 
  read_csv('data/training/ws_50_sum_clean.csv') %>%
  distinct() %>%
  mutate(id = row_number())
data_50_sum_outputnoise <- 
  read_csv('data/training/ws_50_sum_outputnoise.csv') %>%
  distinct(min_sheep, min_wolves, min_grass,
           max_sheep, max_wolves, max_grass,
           sd_sheep, sd_wolves, sd_grass,
           trend_sheep, trend_wolves, trend_grass,
           mean_sheep, mean_wolves, mean_grass,
           initial_number_sheep,  initial_number_wolves,
           sheep_gain_from_food, wolves_gain_from_food,
           sheep_reproduce, wolves_reproduce,
           grass_regrowth,
           .keep_all = TRUE) %>%
  mutate(id = row_number() + nrow(data_50_sum_clean))
data_50_sum_doublenoise <- 
  read_csv('data/training/ws_50_sum_doublenoise.csv') %>%
  distinct(min_sheep, min_wolves, min_grass,
           max_sheep, max_wolves, max_grass,
           sd_sheep, sd_wolves, sd_grass,
           trend_sheep, trend_wolves, trend_grass,
           mean_sheep, mean_wolves, mean_grass,
           initial_number_sheep,  initial_number_wolves,
           sheep_gain_from_food, wolves_gain_from_food,
           sheep_reproduce, wolves_reproduce,
           grass_regrowth,
           .keep_all = TRUE) %>%
  mutate(id = row_number() + 2 * nrow(data_50_sum_clean))

fit_50_sum <- WolfSheepPLSFitting(
  data_clean = data_50_sum_clean,
  data_outputnoise = data_50_sum_outputnoise,
  data_doublenoise = data_50_sum_doublenoise)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_50_sum,
                             sample_size = 200,
                             sample_method = 'random',
                             summarise_runs = 'summarised',
                             datapoints = 'timesteps 50'))
```

Full time series
```{r}
# not summarised
data_series_full_clean <- 
  read_csv('data/training/ws_series_full_clean.csv') %>%
  mutate(id = row_number())
data_series_full_outputnoise <- 
  read_csv('data/training/ws_series_full_outputnoise.csv') %>%
  mutate(id = row_number() + nrow(data_series_full_clean))
data_series_full_doublenoise <- 
  read_csv('data/training/ws_series_full_doublenoise.csv') %>%
  mutate(id = row_number() + 2 * nrow(data_series_full_clean))

fit_series_full <- WolfSheepPLSFitting(
  data_clean = data_series_full_clean,
  data_outputnoise = data_series_full_outputnoise,
  data_doublenoise = data_series_full_doublenoise)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_series_full,
                             sample_size = 200,
                             sample_method = 'random',
                             summarise_runs = 'full',
                             datapoints = 'timeseries'))

# summarised
data_series_sum_clean <- 
  read_csv('data/training/ws_series_sum_clean.csv') %>%
  mutate(id = row_number())
data_series_sum_outputnoise <- 
  read_csv('data/training/ws_series_sum_outputnoise.csv') %>%
  mutate(id = row_number() + nrow(data_series_sum_clean))
data_series_sum_doublenoise <- 
  read_csv('data/training/ws_series_sum_doublenoise.csv') %>%
  mutate(id = row_number() +2 * nrow(data_series_sum_clean))

fit_series_sum <- WolfSheepPLSFitting(
  data_clean = data_series_sum_clean,
  data_outputnoise = data_series_sum_outputnoise,
  data_doublenoise = data_series_sum_doublenoise)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_series_sum,
                             sample_size = 200,
                             sample_method = 'random',
                             summarise_runs = 'summarised',
                             datapoints = 'timeseries'))
```

Save data:
```{r}
errors_df %>%
  mutate(algorithm = 'PLS') %>%
  write_csv('data/results/wolfsheep_PLS_errors.csv')
```

# Plots
```{r}
# data to correct format
errors_long <- PrepErrorsForPlotting(errors_df)

# plot RMSE
RMSE_plot <- PlotRMSE(errors_long)

ggsave('figures/ws_pls_RMSE.pdf',
       height = 30, width = 20, units = 'cm')

# plot point predictive performance
ppp_plot <- PlotPPP(errors_long)

ggsave('figures/ws_pls_ppp.pdf',
       height = 30, width = 20, units = 'cm')

# plot % correctly predicted parameters
perccorrect_plot <- PlotPercCorrect(errors_long)
  # obviously not going to include this because everything is 0

ggsave('figures/ws_pls_perccorrect.pdf',
       height = 30, width = 20, units = 'cm')
```